# 1.创建文件（create）

进行 **Create 系统调用** 时，需要提供的主要参数：
- 所需的外存 **空间大小** （如：`1KB`，对应`1`个磁盘块）;
- 文件存放 **路径** （如：`D:/demo`）;
- **文件名** （如：`file.txt`））。

> 操作系统在处理 Create 系统调用时：
> 1. **分配磁盘空间（文件数据存储）：**
> > - 在 **外存的空闲空间** 中通过空闲分区管理中的方法（如：示位图、空闲表/链等）找出合适的盘块；
> > - 分配给新建文件使用；
> > - 在 FCB（文件控制块）或相关数据结构中，记录所分配盘块的位置。
> 2. **更新目录结构（文件元数据）：**
> > - 根据文件存放路径找到该目录对应的目录文件，在目录文件中创建该文件对应的目录项，包括：文件名、文件的外存信息等。

---

# 2.删除文件（delete）

进行 **Delete 系统调用** 时，需要提供的主要参数：
- 文件存放 **路径** （如：`D:/demo`）;
- **文件名** （如：`file.txt`））。

> 操作系统在处理 Delete 系统调用时：
> 1. **定位目录：**
> > - 根据路径 `D:/demo`，找到对应目录的目录文件；
> > - 在该目录文件中查找是否存在文件名为 `file.txt` 的目录项。
> 2. **回收磁盘空间：**
> > - 根据目录项中记录的信息（如起始块、文件长度、分配方式），执行 **空间回收** 操作；
> > - 实际回收方法取决于系统采用的 **空闲空间管理方式**（如位示图、空闲链表等）。
> 3. **删除目录项：**
> > - 从目录文件中删除该条目录项。

---

# 3.读文件（read）

**`read` 操作：**
- 指明 **哪个文件** （[打开文件表的索引号](06文件系统.md#12-文件系统在内存中的结构)）；
- 指明读取 **数据的大小** （如 1KB）；
- 指明数据读入到 **内存中的目标地址** ；
- 操作系统根据 **读指针（read pointer）** ，将数据从文件读入内存。

示例：📖 `read(fd, buf, nbytes)`
```txt
1. 根据 fd（文件描述符） 找到打开文件表中的对应项（OFT）
2. 根据当前读指针，读取 nbytes 大小的数据
3. 将数据拷贝到用户内存 buf 指定的位置
4. 更新读指针位置
```

---

# 4.写文件（write）

**`write` 操作：**
- 指明 **哪个文件** （[打开文件表的索引号](06文件系统.md#12-文件系统在内存中的结构)）；
- 指明读取 **数据的大小** （如 1KB）；
- 指明从 **内存中哪个位置** 读取数据；
- 操作系统根据 **写指针（write pointer）**，将数据写入外存。

示例：✍️ `write(fd, buf, nbytes)`
```text
1. 根据 fd（文件描述符） 找到打开文件表中的对应项
2. 从用户内存 buf 拷贝 nbytes 大小的数据
3. 写入到写指针指向的文件位置
4. 更新写指针位置
```

---

# 5.打开文件（open）

在对文件进行操作之前，要求用户先使用 **open 系统** 调用 “打开文件”，需要提供的几个主要参数：
- 提供路径、文件名、访问模式（如只读 `r`，读写 `rw` 等）；
- 操作系统查找目录项、检查权限；
- 将目录项信息加载到 **打开文件表中** ；
- 返回一个“编号”给用户程序（即文件描述符），用户后续用它来访问文件。

---

# 6.关闭文件（close）

> 操作系统在处理 **Close 系统** 调用时：
> 1. 用户级打开文件表中对应项被删除；
> 2. 系统级打开文件表中的 `count` 减 1；
> 3. 如果 `count == 0`，则：
> > - 清理文件缓存；
> > - 将文件信息写回磁盘（如 FCB）；
> > - 释放打开文件表项。

---

示例：`open` 和 `close`

```c
int fd = open("D:/demo/test.txt", O_RDWR);
read(fd, buffer, 100);   // 使用文件描述符
close(fd);               // 关闭文件
```